Зачем собирать свой пайплайн, если есть готовые модели для семантической сегментации?



Программа решает задачу семантической сегментации для выделения области неба на изображении.

**Инструменты:**

- **Модель:** `nvidia/segformer-b5-finetuned-ade-640-640` – нейросеть на архитектуре Transformer, предобученная на датасете ADE20K (150 классов).
- **Фреймворк:** `PyTorch` и библиотека `Hugging Face Transformers`.

**Алгоритм работы:**

1. **Инициализация (`SkySegmenter.__init__`):**
    
    - Загружается предобученная модель `Segformer` и соответствующий ей препроцессор.
    - Модель перемещается на доступное устройство (GPU/CPU) и переводится в режим инференса (`eval`).
    - Задается константа `sky_class_id = 2` (ID класса "небо" в датасете ADE20K).
2. **Процесс Сегментации (`segment_sky`):**
    
    - **Вход:** Изображение загружается из файла.
    - **Предобработка:** Изображение передается в препроцессор, который выполняет его изменение размера, нормализацию и преобразование в тензор PyTorch.
    - **Инференс:** Тензор подается в модель, которая на выходе генерирует карту логитов (сырых предсказаний) для каждого из 150 классов.
    - **Постобработка:**
        1. Карта логитов интерполируется до размера исходного изображения.
        2. С помощью операции `argmax` для каждого пикселя находится ID класса с наивысшей вероятностью.
        3. Создается бинарная маска путем сравнения полученной карты классов с `sky_class_id`. Пиксели неба получают значение 255, остальные — 0.
    - **Выход:** Метод возвращает готовую бинарную маску.
3. **Визуализация (`visualize_result`):**
    
    - Для наглядности, на исходное изображение накладывается оверлей, закрашивающий найденную область неба.
